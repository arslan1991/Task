{"version":3,"sources":["lib/visualization.js"],"names":[],"mappings":"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","file":"lib/visualization.js","sourcesContent":["var React = require(\"react\");\nvar {Type} = require(\"./base\");\nvar {View} = require(\"./workbench\");\nvar {CSideEffect} = require(\"./util\");\n\nfunction escapeAttr(v) {\n\treturn `${v}`.replace('\"', '&quot;', \"g\");\n}\n\nclass SVGImage {\n\tconstructor(options) {\n\t\tthis._options = options;\n\t}\n\trender() {\n\t\tvar options = this._options;\n\t\tvar attributes = ([\"x\", \"y\", \"width\", \"height\"]).reduce(\n\t\t\t(acc, name) => {\n\t\t\t\tlet val = options[name];\n\t\t\t\treturn val === undefined ? acc : `${acc} ${name}=\"${escapeAttr(val)}\"`\n\t\t\t},\n\t\t\t`xmlns:xlink=\"http://www.w3.org/1999/xlink\" xlink:href=\"resources/${escapeAttr(options.url)}\"`);\n\t\t// The <g/> element is only needed to hold React's\n\t\t// \"dangerouslySetInnerHTML\".  We don't need it for the SVG tree.\n\t\t// See https://github.com/facebook/react/issues/2863#issuecomment-75253614\n\t\t// for an explanation of the key attribute.\n\t\treturn <g key={attributes} dangerouslySetInnerHTML={{__html: `<image ${attributes}/>`}}/>;\n\t}\n}\n\nfunction CImage(spec, type) {\n\tfunction addImage(node, ctx) {\n\t\tvar {visualization} = ctx;\n\t\tfunction processSpec(spec) {\n\t\t\tif (spec == undefined) {\n\t\t\t\t// do nothing;\n\t\t\t}\n\t\t\telse if (spec instanceof Function)\n\t\t\t\tprocessSpec(spec(ctx));\n\t\t\telse if (spec instanceof Array)\n\t\t\t\tspec.forEach(processSpec);\n\t\t\telse\n\t\t\t\tvisualization.add(new SVGImage(spec));\n\t\t}\n\t\tprocessSpec(spec);\n\t}\n\treturn CSideEffect(addImage, type);\n}\n\n\nclass VisualizationContainer {\n\tconstructor(renderWrapper) {\n\t\tthis._children = [];\n\t\tthis.render = () => renderWrapper(this._children.map(child => child.render()));\n\t}\n\tadd(child) {\n\t\tthis._children.push(child);\n\t}\n}\n\nfunction CWrapVisualization(renderWrapper, type) {\n\treturn new Type(\"visualizationWrapper\", function makeVisualizationWrapper(ctx) {\n\t\tvar subVisualization = new VisualizationContainer(renderWrapper);\n\t\tctx.visualization.add(subVisualization);\n\t\treturn type.makeNode({...ctx, visualization: subVisualization});\n\t});\n}\n\nfunction CTransform(spec, type) {\n\treturn CWrapVisualization(children => <g transform={spec}>{children}</g>, type);\n}\n\nfunction CSVGRoot({width, height}, type) {\n\treturn CWrapVisualization(children => <svg width={width} height={height}>{children}</svg>, type);\n}\n\n\nclass Visualization extends VisualizationContainer {\n\tconstructor() {\n\t\tsuper(\n\t\t\tchildren => <div style={{width: \"100%\", display: \"inline-flex\", flexWrap: \"wrap\"}}>\n\t\t\t\t{children}\n\t\t\t</div>\n\t\t);\n\t}\n}\n\nfunction VVisualization({visualization}) {\n\treturn new View(\"visualization\", function renderVisualization() {\n\t\treturn visualization.render();\n\t});\n}\n\n\nmodule.exports = {\n\tCImage, CTransform, CSVGRoot, CWrapVisualization,\n\tVisualization, VVisualization,\n};\n"],"sourceRoot":"/source/"}