{"version":3,"sources":["lib/root.js"],"names":[],"mappings":"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","file":"lib/root.js","sourcesContent":["var React = require(\"react\");\nvar saveAs = require(\"browser-filesaver\");\nvar {ButtonToolbar, ButtonGroup, Button, Input, Glyphicon, Navbar, Nav} = require('react-bootstrap');\n\nfunction cons(x, list) {\n\tlist = list.slice();\n\tlist.unshift(x);\n\treturn list;\n}\n\nfunction rest(list) {\n\treturn list.slice(1);\n}\n\nfunction first(list) {\n\treturn list[0];\n}\n\nvar RootWidget = React.createClass({\n\tcomponentDidMount() {\n\t\t// Keyboard shortcuts:\n\t\t// - Control-Z: undo\n\t\t// - Shift-Control-Z: redo\n\t\t// TODO: Control-S: save the current configuration\n\t\t//\n\t\t// Undo/redo shortcuts are disabled for Chrome due to the\n\t\t// following problem:\n\t\t//   At least on Chrome/Linux Control-Z triggers\n\t\t//   Chrome's own undo, which can apparently not be\n\t\t//   intercepted by the web page if Chrome has something to\n\t\t//   undo by itself.  So we get the odd behavior that after\n\t\t//   some editing typically\n\t\t//   - the first Control-Z undoes the last edit (via Chrome\n\t\t//     itself) and pushes this change on the app's undo\n\t\t//     stack,\n\t\t//   - the second Control-Z undoes the first change on the\n\t\t//     app's undo stack, i.e., it redoes the last edit,\n\t\t//   - more Control-Zs undo the edit again.\n\t\t//   Similarly a Control-Shift-Z may perform a Chrome redo,\n\t\t//   which is a change action for the app.  This is pushed on\n\t\t//   the undo stack and the redo stack is cleared, which is\n\t\t//   probably not what the user expects.\n\t\tthis.getDOMNode().onkeypress = e => {\n\t\t\tfunction stop() {\n\t\t\t\tif (e.preventDefault)\n\t\t\t\t\te.preventDefault();\n\t\t\t\tif (e.stopPropagation)\n\t\t\t\t\te.stopPropagation();\n\t\t\t}\n\t\t\t// TODO: Search for a standard implementation for detecting specific keys.\n\t\t\tif (e.ctrlKey && !e.altKey && !e.metaKey && !e.shiftKey &&\n\t\t\t\t(e.key === \"z\" // Firefox\n\t\t\t\t // || e.keyCode === 26 // Chrome; disabled, see comment above\n\t\t\t\t))\n\t\t\t{\n\t\t\t\tthis._undo();\n\t\t\t\tstop();\n\t\t\t}\n\t\t\tif (e.ctrlKey && !e.altKey && !e.metaKey && e.shiftKey &&\n\t\t\t\t(e.key === \"Z\" // Firefox\n\t\t\t\t // || e.keyCode === 90 // Chrome; disabled, see comment above\n\t\t\t\t))\n\t\t\t{\n\t\t\t\tthis._redo();\n\t\t\t\tstop();\n\t\t\t}\n\t\t}\n\t},\n\tgetInitialState() {\n\t\treturn {\n\t\t\tnow: this.props.initialJSON,\n\t\t\tpast: [],\n\t\t\tfuture: [],\n\t\t}\n\t},\n\t_undo() {\n\t\tvar {now, past, future} = this.state;\n\t\tif (past.length > 0)\n\t\t\tthis.setState({\n\t\t\t\tnow: first(past),\n\t\t\t\tpast: rest(past),\n\t\t\t\tfuture: cons(now, future)\n\t\t\t});\n\t},\n\t_redo() {\n\t\tvar {now, past, future} = this.state;\n\t\tif (future.length > 0)\n\t\t\tthis.setState({\n\t\t\t\tnow: first(future),\n\t\t\t\tpast: cons(now, past),\n\t\t\t\tfuture: rest(future)\n\t\t\t});\n\t},\n\t_reset() {\n\t\tvar {now, past, future} = this.state;\n\t\tthis.setState({\n\t\t\tnow: undefined,\n\t\t\tpast: cons(now, past),\n\t\t\tfuture: []\n\t\t});\n\t},\n\t_save() {\n\t\tlocalStorage.openCPQ = JSON.stringify(this.state);\n\t},\n\t_restore() {\n\t\tthis.setState(JSON.parse(localStorage.openCPQ));\n\t},\n\t_import() {\n\t\tvar fileReader = new FileReader();\n\t\tvar {now, past} = this.state;\n\t\tfileReader.onload = e => this.setState({\n\t\t\tnow: JSON.parse(e.target.result),\n\t\t\tpast: cons(now, past),\n\t\t\tfuture: []\n\t\t});\n\t\tfileReader.readAsText(document.getElementById(\"import\").files[0], \"UTF-8\"); // TODO can this be improved? getElementById does not seem to be nice\n\t},\n\t_export() {\n\t\tvar blob = new Blob([JSON.stringify(this.state.now, null, 2)], {type: \"application/json;charset=utf-8\"});\n\t\tsaveAs(blob, \"openCPQ.json\");\n\t},\n\trender() {\n\t\tvar {props: {type, initialCtxProvider}, state: {now, past, future}} = this;\n\t\tvar node = type.makeNode({\n\t\t\t...initialCtxProvider(),\n\t\t\tvalue: now,\n\t\t\tupdateTo: newValue => this.setState({\n\t\t\t\tnow: newValue,\n\t\t\t\tpast: cons(now, past),\n\t\t\t\tfuture: []\n\t\t\t})\n\t\t});\n\t\t// TODO the import button should be improved - there are solutions using CSS styling in the web\n\t\treturn <div >\n\t\t\t<Navbar className=\"navbar\" fluid>\n\t    \t\t<Nav className=\"navbar-brand\"/>\n\t\t    \t<Nav>\n\t\t    \t\t<ButtonToolbar>\n\t\t\t\t\t    <ButtonGroup>\n\t\t\t\t\t\t\t<Button className=\"navbar-btn\" disabled={past  .length === 0} onClick={this._undo}><Glyphicon glyph=\"step-backward\"/> undo</Button>\n\t\t\t\t\t\t\t<Button className=\"navbar-btn\" disabled={future.length === 0} onClick={this._redo}><Glyphicon glyph=\"step-forward\"/> redo</Button>\n\t\t\t\t\t    </ButtonGroup>\n\t\t\t\t\t    <ButtonGroup>\n\t\t\t\t\t\t\t<Button className=\"navbar-btn\" disabled={past  .length === 0} onClick={this._reset}><Glyphicon glyph=\"fast-backward\"/> reset</Button>\n\t\t\t\t\t    </ButtonGroup>\n\t\t\t\t\t\t{// local storage is not always available (e.g., in IE with file: URLs)\n\t\t\t\t\t\t\t(window.localStorage == undefined) ? undefined : [\n\t\t\t\t\t\t\t    <ButtonGroup>\n\t\t\t\t\t\t\t\t\t<Button className=\"navbar-btn\" onClick={this._save}><Glyphicon glyph=\"floppy-save\"/> save</Button>\n\t\t\t\t\t\t\t\t\t<Button className=\"navbar-btn\" disabled={localStorage.openCPQ == undefined} onClick={this._restore}><Glyphicon glyph=\"floppy-open\"/> restore</Button>\n\t\t\t\t\t\t\t    </ButtonGroup>\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t    <ButtonGroup>\n\t\t\t\t\t    \t<form className=\"navbar-form\">\n\t\t\t\t\t    \t\t<Input id=\"import\" type=\"file\" name=\"files\"/>\n\t\t\t\t\t    \t\t<Button onClick={this._import}><Glyphicon glyph=\"import\"/> import</Button>\n\t\t\t\t\t    \t\t<Button disabled={this.state.now == undefined} onClick={this._export}><Glyphicon glyph=\"export\"/> export</Button>\n\t\t\t\t\t\t\t</form>\n\t\t\t\t\t    </ButtonGroup>\n\t\t\t\t    </ButtonToolbar>\n\t\t    \t</Nav>\n\t    \t</Navbar>\n\t\t\t<div>\n\t\t\t\t{node.render()}\n\t\t\t</div>\n\t\t</div>;\n\t}\n});\n\nfunction renderTree(type, initialJSON, initialCtxProvider, htmlElement) {\n\tReact.render(\n\t\t<RootWidget type={type} initialJSON={initialJSON} initialCtxProvider={initialCtxProvider}/>,\n\t\thtmlElement\n\t);\n}\n\nmodule.exports = {renderTree};\n"],"sourceRoot":"/source/"}